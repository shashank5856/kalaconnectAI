import React, { useState, useEffect, useMemo } from 'react';
import { Helmet } from 'react-helmet';
import Header from '../../components/ui/Header';
import FilterControls from './components/FilterControls';
import ContentCard from './components/ContentCard';
import ContentDetailModal from './components/ContentDetailModal';
import BulkActions from './components/BulkActions';
import EmptyState from './components/EmptyState';

import Button from '../../components/ui/Button';

const ContentHistory = () => {
  const [selectedLanguage, setSelectedLanguage] = useState('en');
  const [searchQuery, setSearchQuery] = useState('');
  const [dateRange, setDateRange] = useState({ start: '', end: '' });
  const [selectedCraftType, setSelectedCraftType] = useState('');
  const [selectedLanguageFilter, setSelectedLanguageFilter] = useState('');
  const [selectedItems, setSelectedItems] = useState([]);
  const [selectedContent, setSelectedContent] = useState(null);
  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);
  const [sortBy, setSortBy] = useState('newest');

  // Mock content history data
  const mockContentHistory = [
    {
      id: 1,
      craftType: 'Pottery',
      keywords: ['traditional', 'handmade'],
      language: 'en',
      image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400',
      createdAt: '2025-01-15T10:30:00Z',
      productStory: `This exquisite piece of traditional pottery represents centuries of craftsmanship passed down through generations. Each curve and detail is meticulously shaped by skilled hands, using techniques that have remained unchanged for hundreds of years.\n\nThe clay used in this creation is sourced from local riverbanks, known for its unique mineral composition that gives the pottery its distinctive strength and beautiful natural color. The artisan who crafted this piece learned the art from their grandmother, who was renowned in the village for her exceptional pottery skills.\n\nEvery piece tells a story of cultural heritage, patience, and dedication to preserving ancient traditions in our modern world.`,
      socialCaption: `ЁЯП║ Witness the magic of traditional pottery! Each piece is a testament to centuries-old craftsmanship. тЬи\n\n#TraditionalPottery #HandmadeCrafts #CulturalHeritage #ArtisanMade #IndianCrafts #PotteryArt #HandcraftedWithLove #TraditionalArt #CraftedByHand #HeritageArt`,
      culturalContext: `Pottery making in India dates back to the Indus Valley Civilization (3300-1300 BCE), making it one of the world's oldest crafts. This particular style originates from the northern regions of India, where artisans have perfected the technique over millennia.\n\nThe craft is deeply embedded in Indian culture, with pottery being essential for daily life, religious ceremonies, and festivals. The traditional wheel used, called a 'chak', is operated by foot, allowing the potter's hands to remain free to shape the clay.\n\nThis art form represents the sustainable practices of our ancestors, using only natural materials and techniques that are environmentally friendly.`
    },
    {
      id: 2,
      craftType: 'Textiles',
      keywords: ['weaving', 'silk'],
      language: 'hi',
      image: 'https://images.unsplash.com/photo-1610030469983-98e550d6193c?w=400',
      createdAt: '2025-01-14T14:20:00Z',
      productStory: `рдпрд╣ рдЕрджреНрднреБрдд рд░реЗрд╢рдореА рд╡рд╕реНрддреНрд░ рднрд╛рд░рддреАрдп рдмреБрдирдХрд░реЛрдВ рдХреА рдкрд╛рд░рдВрдкрд░рд┐рдХ рдХрд▓рд╛рдХрд╛рд░реА рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ рдзрд╛рдЧрд╛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЪреБрдирд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╣рд╛рдереЛрдВ рд╕реЗ рдмреБрдирд╛ рдЧрдпрд╛ рд╣реИред\n\nрдЗрд╕ рд╡рд╕реНрддреНрд░ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рд░реЗрд╢рдо рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рд░рдВрдЧрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЗрд╕реЗ рдПрдХ рдЕрдиреВрдареА рдЪрдордХ рдФрд░ рдореБрд▓рд╛рдпрдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдмреБрдирдХрд░ рдиреЗ рдЗрд╕ рдХреГрддрд┐ рдХреЛ рдмрдирд╛рдиреЗ рдореЗрдВ рдорд╣реАрдиреЛрдВ рдХрд╛ рд╕рдордп рд▓рдЧрд╛рдпрд╛ рд╣реИред\n\nрдпрд╣ рд╡рд╕реНрддреНрд░ рди рдХреЗрд╡рд▓ рд╕реБрдВрджрд░рддрд╛ рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИ, рдмрд▓реНрдХрд┐ рд╣рдорд╛рд░реА рд╕рдореГрджреНрдз рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХ рд╡рд┐рд░рд╛рд╕рдд рдХрд╛ рднреА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИред`,
      socialCaption: `ЁЯз╡ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реЗрд╢рдореА рдмреБрдирд╛рдИ рдХреА рдЕрджреНрднреБрдд рдХрд▓рд╛рдХрд╛рд░реА! рд╣рд░ рдзрд╛рдЧреЗ рдореЗрдВ рдЫреБрдкреА рд╣реИ рд╕рджрд┐рдпреЛрдВ рдкреБрд░рд╛рдиреА рдкрд░рдВрдкрд░рд╛ред тЬи\n\n#рдкрд╛рд░рдВрдкрд░рд┐рдХрд╡рд╕реНрддреНрд░ #рд╣рд╕реНрддрдирд┐рд░реНрдорд┐рдд #рд░реЗрд╢рдореАрдХрдкрдбрд╝рд╛ #рднрд╛рд░рддреАрдпрд╢рд┐рд▓реНрдк #рдмреБрдирдХрд░рдХрд▓рд╛ #рд╣рд╕реНрддрдХрд▓рд╛ #рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХрд╡рд┐рд░рд╛рд╕рдд #рдкрд╛рд░рдВрдкрд░рд┐рдХрдХрд▓рд╛ #рд╣рд╛рдерд╕реЗрдмрдирд╛ #рд╡рд┐рд░рд╛рд╕рддреАрдХрд▓рд╛`,
      culturalContext: `рднрд╛рд░рдд рдореЗрдВ рд╡рд╕реНрддреНрд░ рдмреБрдирд╛рдИ рдХреА рдкрд░рдВрдкрд░рд╛ рд╣рдЬрд╛рд░реЛрдВ рд╕рд╛рд▓ рдкреБрд░рд╛рдиреА рд╣реИред рдпрд╣ рдХрд▓рд╛ рдореБрдЦреНрдпрддрдГ рджрдХреНрд╖рд┐рдг рднрд╛рд░рдд рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╡рд┐рдХрд╕рд┐рдд рд╣реБрдИ, рдЬрд╣рд╛рдБ рд░реЗрд╢рдо рдХреЗ рдХреАрдбрд╝реЗ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред\n\nрдкрд╛рд░рдВрдкрд░рд┐рдХ рдмреБрдирд╛рдИ рддрдХрдиреАрдХ рдореЗрдВ рд╣реИрдВрдбрд▓реВрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдкреВрд░реНрдгрддрдГ рдорд╛рдирд╡ рд╢рдХреНрддрд┐ рд╕реЗ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реИ рдФрд░ рд╕реНрдерд╛рдпреА рд╡рд┐рдХрд╛рд╕ рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрддреА рд╣реИред\n\nрдпрд╣ рдХрд▓рд╛ рди рдХреЗрд╡рд▓ рдЖрд░реНрдерд┐рдХ рдЖрдзрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ рдмрд▓реНрдХрд┐ рд╣рдорд╛рд░реА рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХ рдкрд╣рдЪрд╛рди рдХреЛ рднреА рд╕рдВрдЬреЛрдП рд░рдЦрддреА рд╣реИред`
    },
    {
      id: 3,
      craftType: 'Woodwork',
      keywords: ['carving', 'sculpture'],
      language: 'ta',
      image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400',
      createdAt: '2025-01-13T09:15:00Z',
      productStory: `роЗроирпНрод роЕро┤роХро╛рой рооро░ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБ родрооро┐ро┤рпН роХро▓рпИроЮро░рпНроХро│ро┐ройрпН рокро╛ро░роорпНрокро░ро┐роп родро┐ро▒роорпИропро┐ройрпН роЪро╛роЯрпНроЪро┐ропро╛роХрпБроорпН. роТро╡рпНро╡рпКро░рпБ ро╡роЯро┐ро╡роорпБроорпН роХро╡ройрооро╛роХ роЪрпЖродрпБроХрпНроХрокрпНрокроЯрпНроЯрпБ, рокро▓ родро▓рпИроорпБро▒рпИроХро│ро╛роХ роХроЯродрпНродрокрпНрокроЯрпНроЯ роирпБроЯрпНрокроЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБред\n\nроЗроирпНрод роХро▓рпИрокрпНрокрпКро░рпБро│ро┐ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ рооро░роорпН роЙро│рпНро│рпВро░рпН роХро╛роЯрпБроХро│ро┐ро▓рпН роЗро░рпБроирпНродрпБ роХро╡ройрооро╛роХ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯродрпБ. роХро▓рпИроЮро░рпН рокро▓ рооро╛родроЩрпНроХро│рпН роЙро┤рпИродрпНродрпБ роЗроирпНрод роЕро▒рпНрокрпБродрооро╛рой рокроЯрпИрокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХро┐ропрпБро│рпНро│ро╛ро░рпНред\n\nроЗродрпБ ро╡рпЖро▒рпБроорпН роЕро▓роЩрпНроХро╛ро░рокрпН рокрпКро░рпБро│рпН роороЯрпНроЯрпБрооро▓рпНро▓, рооро╛ро▒ро╛роХ роироородрпБ рокрогрпНроЯрпИроп роХро▓ро╛роЪрпНроЪро╛ро░родрпНродро┐ройрпН ро╡рпЖро│ро┐рокрпНрокро╛роЯро╛роХрпБроорпН.`,
      socialCaption: `ЁЯк╡ рокро╛ро░роорпНрокро░ро┐роп рооро░ро╡рпЗро▓рпИрокрпНрокро╛роЯрпНроЯро┐ройрпН роЕро▒рпНрокрпБродроорпН! роТро╡рпНро╡рпКро░рпБ роЪрпЖродрпБроХрпНроХро▓ро┐ро▓рпБроорпН ро╡ро░ро▓ро╛ро▒рпБ рокрпЗроЪрпБроХро┐ро▒родрпБ. тЬи\n\n#рокро╛ро░роорпНрокро░ро┐ропрооро░ро╡рпЗро▓рпИ #роХрпИро╡рпЗро▓рпИрокрпНрокро╛роЯрпБ #родрооро┐ро┤рпНроХро▓рпИ #роХро▓рпИроЮро░рпНрокроЯрпИрокрпНрокрпБ #рооро░роЪрпНроЪро┐ро▒рпНрокроорпН #рокро╛ро░роорпНрокро░ро┐ропроХро▓рпИ #роХрпИродрпНродрпКро┤ро┐ро▓рпН #роХро▓ро╛роЪрпНроЪро╛ро░рокро╛ро░роорпНрокро░ро┐ропроорпН #родрооро┐ро┤рпНрокрогрпНрокро╛роЯрпБ #роХро▓рпИроиропроорпН`,
      culturalContext: `родрооро┐ро┤роХродрпНродро┐ро▓рпН рооро░ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБ роЖропро┐ро░роХрпНроХрогроХрпНроХро╛рой роЖрогрпНроЯрпБроХро│ро╛роХ роироЯрпИроорпБро▒рпИропро┐ро▓рпН роЙро│рпНро│родрпБ. роЗроирпНрод роХро▓рпИ роорпБроХрпНроХро┐ропрооро╛роХ роХрпЛропро┐ро▓рпН роХроЯрпНроЯрпБрооро╛ройроорпН рооро▒рпНро▒рпБроорпН роород роЪро┐ро▒рпНрокроЩрпНроХро│рпБроХрпНроХро╛роХ ро╡ро│ро░рпНроЪрпНроЪро┐ рокрпЖро▒рпНро▒родрпБ.\n\nрокро╛ро░роорпНрокро░ро┐роп роХро░рпБро╡ро┐роХро│ро╛рой роЙро│ро┐, роЪрпБродрпНродро┐ропро▓рпН рооро▒рпНро▒рпБроорпН роХродрпНродро┐ рокрпЛройрпНро▒ро╡ро▒рпНро▒рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЗроирпНрод роХро▓рпИ роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ро▒родрпБ. роТро╡рпНро╡рпКро░рпБ рокроХрпБродро┐ропрпБроорпН роХро▓рпИроЮро░ро┐ройрпН роХрпИроХро│ро╛ро▓рпН роороЯрпНроЯрпБроорпЗ ро╡роЯро┐ро╡роорпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.\n\nроЗроирпНрод роХро▓рпИ роироородрпБ роХро▓ро╛роЪрпНроЪро╛ро░ роЕроЯрпИропро╛ро│родрпНродрпИ рокро╛родрпБроХро╛роХрпНроХрпБроорпН роорпБроХрпНроХро┐ропрооро╛рой ро╡ро┤ро┐роорпБро▒рпИропро╛роХрпБроорпН.`
    },
    {
      id: 4,
      craftType: 'Metalwork',
      keywords: ['brass', 'traditional'],
      language: 'en',
      image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400',
      createdAt: '2025-01-12T16:45:00Z',
      productStory: `This magnificent brass artwork showcases the exceptional skill of traditional Indian metalworkers. Each intricate detail has been carefully hammered and shaped using techniques that have been refined over centuries.\n\nThe brass used in this creation is of the highest quality, sourced from trusted suppliers who understand the importance of material purity in traditional crafts. The artisan spent countless hours perfecting every curve and pattern, ensuring that each element contributes to the overall harmony of the piece.\n\nThis artwork represents not just decorative beauty, but also the functional excellence that characterizes Indian metalwork, where form and function unite in perfect balance.`,
      socialCaption: `тЬи Behold the brilliance of traditional brass craftsmanship! Every detail tells a story of dedication and skill. ЁЯФе\n\n#BrassCrafts #TraditionalMetalwork #IndianArtisans #HandcraftedArt #MetalArt #CulturalHeritage #ArtisanSkills #TraditionalCrafts #HandmadeInIndia #HeritageMetalwork`,
      culturalContext: `Metalworking in India has a history spanning over 4,000 years, with evidence found in the Harappan civilization. Brass work, in particular, flourished during the Mughal period and became an integral part of Indian decorative arts.\n\nTraditional techniques like repouss├й (hammering from the reverse side) and chasing (hammering from the front) are still used today. These methods require years of training and exceptional skill to master.\n\nBrass items hold special significance in Indian culture, often used in religious ceremonies, festivals, and as symbols of prosperity and good fortune in Indian households.`
    },
    {
      id: 5,
      craftType: 'Painting',
      keywords: ['miniature', 'traditional'],
      language: 'hi',
      image: 'https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=400',
      createdAt: '2025-01-11T11:30:00Z',
      productStory: `рдпрд╣ рд╕реБрдВрджрд░ рд▓рдШреБ рдЪрд┐рддреНрд░рдХрд╛рд░реА рднрд╛рд░рддреАрдп рдкрд╛рд░рдВрдкрд░рд┐рдХ рдХрд▓рд╛ рдХреА рдЙрддреНрдХреГрд╖реНрдЯ рдорд┐рд╕рд╛рд▓ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ рд░рдВрдЧ рдФрд░ рд░реЗрдЦрд╛ рдХреЛ рдЕрддреНрдпрдзрд┐рдХ рд╕рд╛рд╡рдзрд╛рдиреА рдФрд░ рдзреИрд░реНрдп рдХреЗ рд╕рд╛рде рдЪрд┐рддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред\n\nрдЗрд╕ рдЪрд┐рддреНрд░ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рд░рдВрдЧ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЦрдирд┐рдЬ, рдкреМрдзреЗ рдФрд░ рдХреАрдорддреА рдкрддреНрдерд░ред рдХрд▓рд╛рдХрд╛рд░ рдиреЗ рдмрд╛рд░реАрдХ рдмреНрд░рд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд░ рд╡рд┐рд╡рд░рдг рдХреЛ рдЬреАрд╡рдВрдд рдмрдирд╛рдпрд╛ рд╣реИред\n\nрдпрд╣ рдХрд▓рд╛рдХреГрддрд┐ рди рдХреЗрд╡рд▓ рджреГрд╢реНрдп рд╕реБрдВрджрд░рддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдмрд▓реНрдХрд┐ рд╣рдорд╛рд░реА рд╕рдореГрджреНрдз рдХрд▓рд╛рддреНрдордХ рдкрд░рдВрдкрд░рд╛ рдХрд╛ рднреА рд╕рдВрд░рдХреНрд╖рдг рдХрд░рддреА рд╣реИред`,
      socialCaption: `ЁЯОи рдкрд╛рд░рдВрдкрд░рд┐рдХ рд▓рдШреБ рдЪрд┐рддреНрд░рдХрд╛рд░реА рдХреА рдЕрдиреБрдкрдо рдХрд▓рд╛рдХрд╛рд░реА! рд╣рд░ рд░рдВрдЧ рдореЗрдВ рдЫреБрдкреА рд╣реИ рд╕рджрд┐рдпреЛрдВ рдХреА рдкрд░рдВрдкрд░рд╛ред тЬи\n\n#рд▓рдШреБрдЪрд┐рддреНрд░рдХрд╛рд░реА #рдкрд╛рд░рдВрдкрд░рд┐рдХрдХрд▓рд╛ #рднрд╛рд░рддреАрдпрдЪрд┐рддреНрд░рдХрд▓рд╛ #рд╣рд╕реНрддрдирд┐рд░реНрдорд┐рддрдХрд▓рд╛ #рдЪрд┐рддреНрд░рдХрд╛рд░реА #рдХрд▓рд╛рдХрд╛рд░рдХреАрдХреГрддрд┐ #рд╕рд╛рдВрд╕реНрдХреГрддрд┐рдХрд╡рд┐рд░рд╛рд╕рдд #рдкрд╛рд░рдВрдкрд░рд┐рдХрдЪрд┐рддреНрд░ #рднрд╛рд░рддреАрдпрдХрд▓рд╛рдХрд╛рд░ #рд╡рд┐рд░рд╛рд╕рддреАрдХрд▓рд╛`,
      culturalContext: `рднрд╛рд░рдд рдореЗрдВ рд▓рдШреБ рдЪрд┐рддреНрд░рдХрд╛рд░реА рдХреА рдкрд░рдВрдкрд░рд╛ рдореБрдЧрд▓ рдХрд╛рд▓ рд╕реЗ рд╢реБрд░реВ рд╣реБрдИ рдФрд░ рд░рд╛рдЬрд╕реНрдерд╛рди, рдкрд╣рд╛рдбрд╝реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╡рд┐рдХрд╕рд┐рдд рд╣реБрдИред рдпрд╣ рдХрд▓рд╛ рдореБрдЦреНрдпрддрдГ рджрд░рдмрд╛рд░реА рд╕рдВрд░рдХреНрд╖рдг рдореЗрдВ рдлрд▓реА-рдлреВрд▓реАред\n\nрдкрд╛рд░рдВрдкрд░рд┐рдХ рддрдХрдиреАрдХ рдореЗрдВ рд╣рд╛рдереА рджрд╛рдВрдд, рдХрд╛рдЧрдЬ рдпрд╛ рдХрдкрдбрд╝реЗ рдкрд░ рдмрд╛рд░реАрдХ рдмреНрд░рд╢ рд╕реЗ рдЪрд┐рддреНрд░рдХрд╛рд░реА рдХреА рдЬрд╛рддреА рд╣реИред рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░рдВрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрди рдЪрд┐рддреНрд░реЛрдВ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИред\n\nрдпрд╣ рдХрд▓рд╛ рднрд╛рд░рддреАрдп рдЗрддрд┐рд╣рд╛рд╕, рдкреБрд░рд╛рдг рдФрд░ рджреИрдирд┐рдХ рдЬреАрд╡рди рдХреЗ рджреГрд╢реНрдпреЛрдВ рдХреЛ рд╕рдВрдЬреЛрдиреЗ рдХрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдорд╛рдзреНрдпрдо рд░рд╣реА рд╣реИред`
    },
    {
      id: 6,
      craftType: 'Jewelry',
      keywords: ['silver', 'ornate'],
      language: 'ta',
      image: 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400',
      createdAt: '2025-01-10T13:20:00Z',
      productStory: `роЗроирпНрод роЕро┤роХро╛рой ро╡рпЖро│рпНро│ро┐ роироХрпИроХро│рпН родрооро┐ро┤рпН роироХрпИроХрпНроХро▓рпИроЮро░рпНроХро│ро┐ройрпН рокро╛ро░роорпНрокро░ро┐роп родро┐ро▒роорпИропро┐ройрпН роЪро┐ро▒роирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯрпБ. роТро╡рпНро╡рпКро░рпБ ро╡роЯро┐ро╡роорпБроорпН роХро╡ройрооро╛роХ ро╡роЯро┐ро╡роорпИроХрпНроХрокрпНрокроЯрпНроЯрпБ, рокро▓ родро▓рпИроорпБро▒рпИроХро│ро╛роХ роХроЯродрпНродрокрпНрокроЯрпНроЯ роирпБроЯрпНрокроЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБред\n\nроЗроирпНрод роироХрпИроХро│ро┐ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ ро╡рпЖро│рпНро│ро┐ родрпВропрпНроорпИропро╛ройродрпБ рооро▒рпНро▒рпБроорпН рокро╛ро░роорпНрокро░ро┐роп роорпБро▒рпИроХро│ро┐ро▓рпН роЪрпБродрпНродро┐роХро░ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ. роХро▓рпИроЮро░рпН роТро╡рпНро╡рпКро░рпБ ро╡роЯро┐ро╡родрпНродрпИропрпБроорпН роХрпИропро╛ро▓рпН роЪрпЖродрпБроХрпНроХро┐, роЕродройрпН родройро┐родрпНродрпБро╡родрпНродрпИ роЙро▒рпБродро┐ роЪрпЖропрпНродрпБро│рпНро│ро╛ро░рпНред\n\nроЗродрпБ ро╡рпЖро▒рпБроорпН роЕро▓роЩрпНроХро╛ро░роорпН роороЯрпНроЯрпБрооро▓рпНро▓, рооро╛ро▒ро╛роХ роироородрпБ роХро▓ро╛роЪрпНроЪро╛ро░ роЕроЯрпИропро╛ро│родрпНродро┐ройрпН ро╡рпЖро│ро┐рокрпНрокро╛роЯро╛роХрпБроорпН.`,
      socialCaption: `ЁЯТО рокро╛ро░роорпНрокро░ро┐роп ро╡рпЖро│рпНро│ро┐ роироХрпИроХро│ро┐ройрпН роЕро┤роХрпБ! роТро╡рпНро╡рпКро░рпБ ро╡роЯро┐ро╡родрпНродро┐ро▓рпБроорпН роХро▓рпИроЮро░ро┐ройрпН родро┐ро▒роорпИ рокро┐ро░родро┐рокро▓ро┐роХрпНроХро┐ро▒родрпБ. тЬи\n\n#рокро╛ро░роорпНрокро░ро┐ропроироХрпИроХро│рпН #ро╡рпЖро│рпНро│ро┐роироХрпИроХро│рпН #родрооро┐ро┤рпНроироХрпИроХрпНроХро▓рпИ #роХрпИро╡рпЗро▓рпИроироХрпИроХро│рпН #рокро╛ро░роорпНрокро░ро┐ропроХро▓рпИ #роироХрпИроХрпНроХро▓рпИроЮро░рпН #роХро▓ро╛роЪрпНроЪро╛ро░рокро╛ро░роорпНрокро░ро┐ропроорпН #родрооро┐ро┤рпНрокрогрпНрокро╛роЯрпБ #роХрпИродрпНродрпКро┤ро┐ро▓рпН #рокро╛ро░роорпНрокро░ро┐ропро╡роЯро┐ро╡роорпИрокрпНрокрпБ`,
      culturalContext: `родрооро┐ро┤роХродрпНродро┐ро▓рпН роироХрпИроХрпНроХро▓рпИ роЖропро┐ро░роХрпНроХрогроХрпНроХро╛рой роЖрогрпНроЯрпБроХро│ро╛роХ ро╡ро│ро░рпНроЪрпНроЪро┐ рокрпЖро▒рпНро▒рпБ ро╡ро░рпБроХро┐ро▒родрпБ. роЪроЩрпНроХ роХро╛ро▓родрпНродро┐ро▓ро┐ро░рпБроирпНродрпЗ родрооро┐ро┤ро░рпНроХро│рпН роироХрпИ роЕрогро┐ро╡родро┐ро▓рпН роЪро┐ро▒роирпНродрпБ ро╡ро┐ро│роЩрпНроХро┐ройро░рпН.\n\nрокро╛ро░роорпНрокро░ро┐роп роироХрпИроХрпНроХро▓рпИропро┐ро▓рпН роорпЖро┤рпБроХрпБ ро╡ро╛ро░рпНрокрпНрокрпБ, роХрпИро╡рпЗро▓рпИрокрпНрокро╛роЯрпБ рооро▒рпНро▒рпБроорпН рокрпКро▒ро┐рокрпНрокрпБ рокрпЛройрпНро▒ роирпБроЯрпНрокроЩрпНроХро│рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ройрпНро▒рой. роТро╡рпНро╡рпКро░рпБ рокроХрпБродро┐ропрпБроорпН роХро▓рпИроЮро░ро┐ройрпН роХрпИроХро│ро╛ро▓рпН роороЯрпНроЯрпБроорпЗ ро╡роЯро┐ро╡роорпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.\n\nроироХрпИроХро│рпН родрооро┐ро┤рпН роХро▓ро╛роЪрпНроЪро╛ро░родрпНродро┐ро▓рпН роороЩрпНроХро▓родрпНродро┐ройрпН роЕроЯрпИропро╛ро│рооро╛роХро╡рпБроорпН, роЪрпЖро▓рпНро╡родрпНродро┐ройрпН роХрпБро▒ро┐ропрпАроЯро╛роХро╡рпБроорпН роХро░рпБродрокрпНрокроЯрпБроХро┐ройрпНро▒рой.`
    }
  ];

  // Load language preference on component mount
  useEffect(() => {
    const savedLanguage = localStorage.getItem('selectedLanguage');
    if (savedLanguage) {
      setSelectedLanguage(savedLanguage);
    }
  }, []);

  // Filter and sort content
  const filteredContent = useMemo(() => {
    let filtered = mockContentHistory.filter(content => {
      // Search query filter
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        const matchesSearch = 
          content.craftType.toLowerCase().includes(query) ||
          content.keywords.some(keyword => keyword.toLowerCase().includes(query)) ||
          content.productStory.toLowerCase().includes(query) ||
          content.socialCaption.toLowerCase().includes(query) ||
          content.culturalContext.toLowerCase().includes(query);
        
        if (!matchesSearch) return false;
      }

      // Date range filter
      if (dateRange.start || dateRange.end) {
        const contentDate = new Date(content.createdAt);
        if (dateRange.start && contentDate < new Date(dateRange.start)) return false;
        if (dateRange.end && contentDate > new Date(dateRange.end + 'T23:59:59')) return false;
      }

      // Craft type filter
      if (selectedCraftType && content.craftType.toLowerCase() !== selectedCraftType.toLowerCase()) {
        return false;
      }

      // Language filter
      if (selectedLanguageFilter && content.language !== selectedLanguageFilter) {
        return false;
      }

      return true;
    });

    // Sort content
    filtered.sort((a, b) => {
      switch (sortBy) {
        case 'newest':
          return new Date(b.createdAt) - new Date(a.createdAt);
        case 'oldest':
          return new Date(a.createdAt) - new Date(b.createdAt);
        case 'craftType':
          return a.craftType.localeCompare(b.craftType);
        default:
          return 0;
      }
    });

    return filtered;
  }, [mockContentHistory, searchQuery, dateRange, selectedCraftType, selectedLanguageFilter, sortBy]);

  const handleSelectItem = (itemId, isSelected) => {
    setSelectedItems(prev => {
      if (isSelected) {
        return [...prev, mockContentHistory.find(item => item.id === itemId)];
      } else {
        return prev.filter(item => item.id !== itemId);
      }
    });
  };

  const handleSelectAll = () => {
    setSelectedItems(filteredContent);
  };

  const handleDeselectAll = () => {
    setSelectedItems([]);
  };

  const handleViewContent = (content) => {
    setSelectedContent(content);
    setIsDetailModalOpen(true);
  };

  const handleCopyContent = async (content, type = 'All Content') => {
    try {
      let textToCopy = '';
      if (type === 'All Content') {
        textToCopy = `${content.productStory}\n\n${content.socialCaption}\n\n${content.culturalContext}`;
      } else {
        textToCopy = content[type.toLowerCase().replace(' ', '')];
      }
      
      await navigator.clipboard.writeText(textToCopy);
      // You could add a toast notification here
    } catch (err) {
      console.error('Failed to copy content: ', err);
    }
  };

  const handleRegenerateContent = (content) => {
    // Navigate to dashboard with pre-filled parameters
    // This would typically use React Router's navigate function 
    console.log('Regenerating content with parameters:', {
      craftType: content.craftType,
      keywords: content.keywords,
      language: content.language
    });
  };

  const handleDeleteContent = (contentId) => {
    // In a real app, this would make an API call
    console.log('Deleting content:', contentId);
  };

  const handleBulkDelete = () => {
    // In a real app, this would make an API call
    console.log('Bulk deleting:', selectedItems.map(item => item.id));
    setSelectedItems([]);
  };

  const handleBulkExport = () => {
    // Create export data
    const exportData = selectedItems.map(item => ({
      craftType: item.craftType,
      keywords: item.keywords.join(', '),
      language: item.language,
      createdAt: item.createdAt,
      productStory: item.productStory,
      socialCaption: item.socialCaption,
      culturalContext: item.culturalContext
    }));

    // Convert to JSON and download
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `content-history-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
  };

  const handleClearFilters = () => {
    setSearchQuery('');
    setDateRange({ start: '', end: '' });
    setSelectedCraftType('');
    setSelectedLanguageFilter('');
  };

  const hasActiveFilters = searchQuery || dateRange.start || dateRange.end || 
                          selectedCraftType || selectedLanguageFilter;

  return (
    <div className="min-h-screen bg-background">
      <Helmet>
        <title>Content History - KalaConnect AI</title>
        <meta name="description" content="Access and manage your previously generated marketing content for traditional crafts" />
      </Helmet>

      <Header />

      <main className="pt-16 pb-20 md:pb-8">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          {/* Page Header */}
          <div className="mb-8">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-heading font-bold text-foreground mb-2">
                  Content History
                </h1>
                <p className="text-text-secondary">
                  Access, manage, and reuse your previously generated marketing content
                </p>
              </div>

              {filteredContent.length > 0 && (
                <div className="flex items-center space-x-2">
                  <select
                    value={sortBy}
                    onChange={(e) => setSortBy(e.target.value)}
                    className="px-3 py-2 border border-border rounded-md bg-input text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  >
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="craftType">By Craft Type</option>
                  </select>
                </div>
              )}
            </div>
          </div>

          {/* Filter Controls */}
          <FilterControls
            searchQuery={searchQuery}
            onSearchChange={setSearchQuery}
            dateRange={dateRange}
            onDateRangeChange={setDateRange}
            selectedCraftType={selectedCraftType}
            onCraftTypeChange={setSelectedCraftType}
            selectedLanguage={selectedLanguageFilter}
            onLanguageChange={setSelectedLanguageFilter}
            onClearFilters={handleClearFilters}
            totalResults={filteredContent.length}
          />

          {/* Bulk Actions */}
          {selectedItems.length > 0 && (
            <BulkActions
              selectedItems={selectedItems}
              onSelectAll={handleSelectAll}
              onDeselectAll={handleDeselectAll}
              onBulkDelete={handleBulkDelete}
              onBulkExport={handleBulkExport}
              totalItems={filteredContent.length}
            />
          )}

          {/* Content Grid */}
          {filteredContent.length > 0 ? (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
              {filteredContent.map((content) => (
                <ContentCard
                  key={content.id}
                  content={content}
                  onView={handleViewContent}
                  onCopy={handleCopyContent}
                  onRegenerate={handleRegenerateContent}
                  onDelete={handleDeleteContent}
                  isSelected={selectedItems.some(item => item.id === content.id)}
                  onSelect={handleSelectItem}
                />
              ))}
            </div>
          ) : (
            <EmptyState 
              hasFilters={hasActiveFilters}
              onClearFilters={handleClearFilters}
            />
          )}

          {/* Load More Button (for pagination in real app) */}
          {filteredContent.length > 0 && filteredContent.length >= 6 && (
            <div className="text-center mt-12">
              <Button
                variant="outline"
                size="lg"
                iconName="ChevronDown"
                iconPosition="right"
                iconSize={18}
              >
                Load More Content
              </Button>
            </div>
          )}
        </div>
      </main>

      {/* Content Detail Modal */}
      <ContentDetailModal
        content={selectedContent}
        isOpen={isDetailModalOpen}
        onClose={() => {
          setIsDetailModalOpen(false);
          setSelectedContent(null);
        }}
        onCopy={handleCopyContent}
        onRegenerate={handleRegenerateContent}
      />
    </div>
  );
};

export default ContentHistory;